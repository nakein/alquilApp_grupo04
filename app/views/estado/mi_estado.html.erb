<h1>Bienvenido a tu estado </h1>
<% if (Alquiler.where(user_id: current_usuario.id,status: "en_curso").exists?) then %>
<h2>Alquiler en curso</h2>
<div>Tiempo restante: <span id="time">--:--:--</span></div>
<%= button_to "Cancelar alquiler", alquiler_path(@alquiler.vehicle_id), method: :delete, class: "btn btn-danger" %>
<%= link_to "Finalizar alquiler", root_path, :class => 'btn btn-warning mt-3'  %>
<script>
    function startTimer(duration, display) {
        var timer = duration, hours, minutes, seconds;
        setInterval(function () {
            hours = parseInt(timer / 60 / 60, 10)
            minutes = parseInt(timer / 60 % 60 , 10)
            seconds = parseInt(timer % 60, 10);

            hours = hours < 10 ? "0" + hours : hours;
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = hours + ":" + minutes + ":" + seconds;

            if (--timer < 0) {
                timer = duration;
            }


        }, 1000);
    }

    window.onload = function () {
        var timeRemaining = '<%= (@alquiler.created_at + @alquiler.hours.hours) - Time.now %>',
            display = document.querySelector('#time');
        startTimer(timeRemaining, display);
    };

</script>

<div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
            <label class="form-check-label" for="flexCheckDefault">Cargué gasolina</label>
    </div>

<div class="card mb-3">
            <div class="row g-0">
                <div class="col-md-4">
                    <%= image_tag Vehiculo.find(@alquiler.vehicle_id).image, class: "img-fluid rounded-start" if Vehiculo.find(@alquiler.vehicle_id).image.attached?%>
                </div>
                <div class="col-md-8">
                <div class="card-body">
                    <h5 class="card-title">Informacion del vehículo</h5>
                    <div class="row mt-4">
                        <p class="card-text col-4"><b>Marca: </b><%= Vehiculo.find(@alquiler.vehicle_id).brand %></p>
                        <p class="card-text col-4"><b>Modelo: </b><%= Vehiculo.find(@alquiler.vehicle_id).model %></p>
                        <p class="card-text col-4"><b>Patente: </b><%= Vehiculo.find(@alquiler.vehicle_id).license_plate %></p>
                        <p class="card-text col-4"><b>Color: </b><%= Vehiculo.find(@alquiler.vehicle_id).color %></p>
                        <p class="card-text col-4"><b>Tipo de combustible: </b><%= Vehiculo.find(@alquiler.vehicle_id).fuel_type %></p>
                        <p class="card-text col-4"><b>Capacidad: </b><%= Vehiculo.find(@alquiler.vehicle_id).capacity %></p>
                        <p class="card-text col-4"><b>Tipo de transmision: </b><%= Vehiculo.find(@alquiler.vehicle_id).transmission %></p>
                        <p class="card-text col-4"><b>Proximidad: </b><%= Vehiculo.find(@alquiler.vehicle_id).proximity %>m</p>
                    </div>
                </div>
                </div>
            </div>
            
        </div>
<% else %>
<h2>Sin alquiler en curso</h2>
<% end %>

<h2>Historial de alquileres</h2>
<div class="row row-cols-1 row-cols-md-4 g-0 p-2 mb-5">
        <% Alquiler.where(user_id: current_usuario.id,status: "completado").all.reverse_each do |alqui| %> 
                <div class="col g-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title"><%= Vehiculo.where(id: alqui.vehicle_id)[0].brand %> <%= Vehiculo.where(id: alqui.vehicle_id)[0].model %></h5>
                            <%= image_tag Vehiculo.where(id: alqui.vehicle_id)[0].image, class: "col-12" if Vehiculo.where(id: alqui.vehicle_id)[0].image.attached?%>
                            <p class="card-text">Estado del alquiler: <%= alqui.status %> </p>
                            <p class="card-text">Horas alquiladas: <%= alqui.hours %> </p>
                            <p class="card-text">Costo del alquiler: $<%= alqui.hours*200 %> </p>
                            <p class="card-text">Inicio de alquiler: <%= alqui.created_at.time %> </p>
                            <p class="card-text">Final de alquiler: <%= alqui.updated_at.time %> </p>
                        </div>
                    </div>
                </div>  
        <% end %>
 </div>